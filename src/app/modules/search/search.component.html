<div class="component">
  <div class="sidebar">
    @if(request){
      <div class="controls">
        <mat-accordion multi="multi">
          <app-passenger-control [userId]="userId" [(passengers)]="request.passengers" (passengersChange)="requestDataChanged()"/>
          <app-time-control [(dateTime)]="time" (dateTimeChange)="requestDataChanged()" [(type)]="request.timeType" (typeChange)="requestDataChanged()"/>
          <app-options-control [(options)]="request.options" (optionsChange)="requestDataChanged()"/>
          <app-route-control [(route)]="request.route" (routeChange)="requestDataChanged()" [(valid)]="routeValid"/>
        </mat-accordion>
      </div>
      <div class="search">
        <button mat-fab extended [disabled]="!passengersValid || !routeValid || connectionsLoading" (click)="search()">
          <mat-spinner [diameter]="24" *ngIf="connectionsLoading"/>
          <mat-icon *ngIf="!connectionsLoading">search</mat-icon>
          <span *ngIf="!connectionsLoading" i18n>Search</span>
        </button>
      </div>
    }
  </div>
  @if(!connections){
    <div class="search-infos">
      <div class="info-container">
        <span class="info-headline" i18n>Search connection</span>
        <div class="info-entry">
          <span class="number">1</span>
          <span class="info-text" i18n>Select the passengers</span>
        </div>
        <div class="info-entry">
          <span class="number">2</span>
          <span class="info-text" i18n>Select the time of the journey</span>
        </div>
        <div class="info-entry">
          <span class="number">3</span>
          <span class="info-text" i18n>Select the route</span>
        </div>
        <div class="info-entry">
          <span class="number">4</span>
          <span class="info-text" i18n>Search connections</span>
        </div>
        <div class="info-entry">
          <span class="number">5</span>
          <span i18n>Select connection</span>
        </div>
      </div>
    </div>
  }@else if(connections.length == 0){
    <div class="search-infos">
      <div class="info-container">
        <span class="info-headline" i18n>No connections found</span>
        <span class="info-text" i18n>Please adjust the request parameters</span>
      </div>
    </div>
  }@else{
    <div class="connections">
      <div class="pagination">
        <button mat-stroked-button [disabled]="pageEarlierLoading" (click)="searchEarlier()">
          <mat-spinner [diameter]="24" *ngIf="pageEarlierLoading"/>
          <mat-icon *ngIf="!pageEarlierLoading">keyboard_arrow_up</mat-icon>
          <span *ngIf="!pageEarlierLoading" i18n>Earlier</span>
        </button>
      </div>
      @for(connection of connections; track connection.id; let i = $index){
        @if(i === 0 || getCompareDate(connection) !== getCompareDate(connections[i - 1])){
          <span class="date">{{getStartDate(connection) | date: 'fullDate'}}</span>
        }
        <app-connection-card [connection]="connection" [showBikeInfo]="bikeInfoRequired" [showAccessibilityInfo]="accessibilityInfoRequired" [requestedClass]="requestedClass"/>
      }
      <div class="pagination">
        <button mat-stroked-button [disabled]="pageLaterLoading" (click)="searchLater()">
          <mat-spinner [diameter]="24" *ngIf="pageLaterLoading"/>
          <mat-icon *ngIf="!pageLaterLoading">keyboard_arrow_down</mat-icon>
          <span *ngIf="!pageLaterLoading" i18n>Later</span>
        </button>
      </div>
    </div>
  }
</div>
